{% extends 'base_dashboard.html' %}
{% load static %}

{% block title %}Dashboard - A. Blog{% endblock title %}

{% block main_content %}
    <h1 class="h2 mb-4">Dashboard</h1>
   
      <div class="row">
                  <div class="col-md-6 col-xl-3 mb-4">
                    <div class="card shadow bg-primary text-white border-0">
                      <div class="card-body">
                        <div class="row align-items-center">
                          <div class="col-3 text-center">
                            <span class="circle circle-sm bg-primary-light">
                              <i class="fe fe-16 fe-shopping-bag text-white mb-0"></i>
                            </span>
                          </div>
                          <div class="col pr-0">
                            <p class="small text-muted mb-0">Total posts</p>
                            <span class="h3 mb-0 text-white">{{ total_posts }}</span>
                          
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-6 col-xl-3 mb-4">
                    <div class="card shadow border-0">
                      <div class="card-body">
                        <div class="row align-items-center">
                          <div class="col-3 text-center">
                            <span class="circle circle-sm bg-primary">
                              <i class="fe fe-16 fe-shopping-cart text-white mb-0"></i>
                            </span>
                          </div>
                          <div class="col pr-0">
                            <p class="small text-muted mb-0">Published posts</p>
                            <span class="h3 mb-0">{{ published_posts }}</span>
                            
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <!-- if not a staff member -->
                  {% if not request.user.is_staff %}
                  <div class="col-md-6 col-xl-3 mb-4">
                    <div class="card shadow border-0">
                      <div class="card-body">
                        <div class="row align-items-center">
                          <div class="col-3 text-center">
                            <span class="circle circle-sm bg-primary">
                              <i class="fe fe-16 fe-shopping-cart text-white mb-0"></i>
                            </span>
                          </div>
                          <div class="col pr-0">
                            <p class="small text-muted mb-0">Drafts</p>
                            <span class="h3 mb-0">{{ draft_posts }}</span>
                            
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  {% endif %}
                  <div class="col-md-6 col-xl-3 mb-4">
                    <div class="card shadow border-0">
                      <div class="card-body">
                        <div class="row align-items-center">
                          <div class="col-3 text-center">
                            <span class="circle circle-sm bg-primary">
                              <i class="fe fe-16 fe-activity text-white mb-0"></i>
                            </span>
                          </div>
                          <div class="col">
                            <p class="small text-muted mb-0">Verified </p>
                            <span class="h3 mb-0">{{ verified_posts }}</span>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  
      </div>
        

    <!-- stats -->
      

    <!-- table of posts and post information -->
     <div class="row">
                <!-- Striped rows -->
                <div class="col-md-12 my-4">
                  <!-- if user is a staff member -->
                  {% if request.user.is_staff %}
                    <h2 class="h4 mb-1">All Posts</h2>
                    <p class="mb-4">All posts and status</p>
                  {% else %}
                    <h2 class="h4 mb-1">My Posts</h2>
                    <p class="mb-4">All my posts and status</p>
                  {% endif %}

                  <div class="card shadow">
                    <div class="card-body">
                      <div class="toolbar row mb-3">
                        <div class="col">
                          <form class="form-inline">
                            <div class="form-row">
                              <div class="form-group col-auto">
                                <label for="search" class="sr-only">Search</label>
                                <input type="text" class="form-control" id="search" value="" placeholder="Search">
                              </div>
                              <div class="form-group col-auto ml-3">
                                <label class="my-1 mr-2 sr-only" for="inlineFormCustomSelectPref">Status</label>
                                <select class="custom-select my-1 mr-sm-2" id="inlineFormCustomSelectPref">
                                  <option selected>Choose...</option>
                                  <option value="1">Drafts</option>
                                  <option value="2">Published</option>
                                  <option value="3">Verified</option>
                                  <option value="3">All</option>
                                </select>
                              </div>
                            </div>
                          </form>
                        </div>
                        <div class="col ml-auto">
                          <div class="dropdown float-right">
                            <a href="{% url 'blog:post-create' %}" class="btn btn-primary btn-sm">Add Post</a>
                            
                            
                            <!-- <button class="btn btn-secondary dropdown-toggle" type="button" id="actionMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"> Action </button> -->
                            <!-- <div class="dropdown-menu" aria-labelledby="actionMenuButton"> -->
                              <!-- <a class="dropdown-item" href="#">Export</a> -->
                              <!-- <a class="dropdown-item" href="#">Delete</a> -->
                              
                            </div>
                          </div>
                        </div>
                      </div>
                      <!-- table -->
                      <table class="table table-bordered">
                        <thead>
                          
                          <tr role="row">
                            <!-- <th>
                              <div class="custom-control custom-checkbox">
                                <input type="checkbox" class="custom-control-input" id="all">
                                <label class="custom-control-label" for="all"></label>
                              </div>
                            </th> -->
                            {% if request.user.is_staff %}
                            <th>Author</th>
                            {% endif %}
                            <th>Post</th>
                            <th>Status</th>
                            <th>Category</th>
                            <th>Submitted for Verification</th>
                            <th>Verified</th>
                            <th>Created At</th>
                            
                          </tr>
                        </thead>
                        <tbody>
                        {% for post in page_obj %}
                          <tr>
                            <!-- <td>
                              <div class="custom-control custom-checkbox">
                                <input type="checkbox" class="custom-control-input" id="4574">
                                <label class="custom-control-label" for="4574"></label>
                              </div>
                            </td> -->
                            {% if request.user.is_staff %}
                            <!-- <td>{{ post.author.firstname }} {{ post.author.lastname }}</td> -->
                            <td><a class="" href="{% url 'blog:user-profile' post.author.id %}">{{ post.author.username }}</a></td>
                            {% endif %}
                            <td><a 
                              class="" 
                              href="
                              {% if post.author == request.user %}
                              {% url 'blog:post-edit' post.id %}
                              {% else %}
                              {% url 'blog:post-detail' post.id %}
                              {% endif %}">
                              {{post.title}}
                            </a></td>
                            <td>
                              {% if post.status == 'draft' %}
                                <span class="dot dot-lg bg-warning mr-2"></span>Draft
                              {% elif post.status == 'published' %}
                                <span class="dot dot-lg bg-success mr-2"></span>Published
                              {% elif post.status == 'archived' %}
                                <span class="dot dot-lg bg-danger mr-2"></span>Archived
                              {% endif %}
                              <!-- {{post.status}} -->
                            </td>
                            <td>{{post.category}}</td>
                            <td>{% if post.is_submitted_for_verification %}
                              <span class="dot dot-lg bg-success mr-2"></span>Yes{% else %}<span class="dot dot-lg bg-danger mr-2"></span>No{% endif %}</td>
                            <td>{% if post.is_verified %}<span class="dot dot-lg bg-success mr-2"></span>Yes{% else %}<span class="dot dot-lg bg-danger mr-2"></span>No{% endif %}</td>
                            <td>{{post.created_at}}</td>

                            
                    
                            
                            <td><button class="btn btn-sm dropdown-toggle more-horizontal" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <span class="text-muted sr-only">Action</span>
                              </button>
                              <div class="dropdown-menu dropdown-menu-right">
                                <!-- for unverified posts -->
                                 <!-- check if post was submitted for verification -->
                                {% if not post.is_submitted_for_verification %}
                                  <a class="dropdown-item" href="{% url 'blog:submit_post_for_verification' post.id %}">Submit for Review</a>
                                {% endif %}
                                <!-- for verified posts -->
                                {% if not post.is_verified %}
                                  {% else %}
                                  <!-- for verified but drafted posts -->
                                  {% if post.author == request.user %}
                                    {% if not post.is_published %}
                                      <!-- <a class="dropdown-item" href="{% url 'blog:publish_post' post.id %}">Publish</a> -->
                                      <form method="post" action="{% url 'blog:publish_post' post.id %}">
                                      {% csrf_token %}
                                      <button type="submit" class="btn btn-success">
                                          Publish
                                      </button>
                                      </form>

                                    {% else %}
                                      <!-- for published posts -->
                                      <!-- <a class="dropdown-item" href="{% url 'blog:publish_post' post.id %}">Unpublish</a> -->
                                      <form method="post" action="{% url 'blog:publish_post' post.id %}">
                                      {% csrf_token %}
                                      <button type="submit" class="btn btn-success">
                                          Unpublish
                                      </button>
                                      </form>
                                    {% endif %}
                                  {% endif %}
                                {% endif %}
                                  <a class="dropdown-item" href="{% url 'blog:post-detail' post.id %}">View</a>
                                {% if post.author == request.user %}
                                  <a class="dropdown-item" href="{% url 'blog:post-edit' post.id %}">Edit</a>
                                  <a class="dropdown-item" href="{% url 'blog:post-delete' post.id %}">Delete</a>
                                {% endif %}
                                <!-- check if user is staff -->
                                {% if request.user.is_staff %}
                                    <!-- check if post is verified -->
                                    {% if not post.is_verified %}
                                      <!-- you can not verify your own posts -->
                                      {% if post.author != request.user %}
                                        <a class="dropdown-item" href="{% url 'blog:verify_post' post.id %}">Verify</a>
                                      {% endif %}
                                    {% endif %}
                                {% endif %}
                              </div>
                            </td>
                          </tr>
                          
                        {% endfor %} 
                        </tbody>
                      </table>
                      <!-- <nav aria-label="Table Paging" class="mb-0 text-muted">
                        <ul class="pagination justify-content-end mb-0">
                          <li class="page-item"><a class="page-link" href="#">Previous</a></li>
                          <li class="page-item"><a class="page-link" href="#">1</a></li>
                          <li class="page-item"><a class="page-link" href="#">2</a></li>
                          <li class="page-item"><a class="page-link" href="#">3</a></li>
                          <li class="page-item"><a class="page-link" href="#">Next</a></li>
                        </ul>
                      </nav> -->

                      <!-- pagination -->
                      {% block pagination %}
                          {% if page_obj.has_other_pages %}
                              <nav aria-label="Table Paging" class="mb-2 text-muted">
                                  <ul class="pagination justify-content-end mb-0">
                                      {% if page_obj.has_previous %}
                                          <li class="page-item"><a class="page-link" href="?page={{ page_obj.previous_page_number }}">Previous</a></li>
                                      {% endif %}
                                      {% for num in page_obj.paginator.page_range %}
                                          {% if page_obj.number == num %}
                                              <li class="page-item active"><span class="page-link">{{ num }}</span></li>
                                          {% else %}
                                              <li class="page-item"><a class="page-link" href="?page={{ num }}">{{ num }}</a></li>
                                          {% endif %}
                                      {% endfor %}
                                      {% if page_obj.has_next %}
                                          <li class="page-item"><a class="page-link" href="?page={{ page_obj.next_page_number }}">Next</a></li>
                                      {% endif %}
                                  </ul>
                              </nav>
                          {% endif %}
                      {% endblock pagination %}
                    </div>
                  </div>
                </div> <!-- simple table -->
    </div> <!-- end section -->
{% endblock main_content %}